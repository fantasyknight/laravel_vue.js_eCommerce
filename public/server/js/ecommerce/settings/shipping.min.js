$(document).ready(function(){"use strict";var e,t,o=[];$(".add-shipping-button").click(function(){new PNotify({title:"Warning",text:"Please save shipping zone first",type:"error",addclass:"notification-warning",icon:"fas fa-exclamation"})}),$(".create-shipping-button").click(function(){var e,t,o,a=$(".method-add-select").val(),l=$(".ecommerce-setting-form").data("zone-id");"free"==a?(e="Free shipping",t="Lets you charge a fixed rate for shipping.",o="free"):"flat"==a?(e="Flat rate",t="Free shipping is a special method which can be triggered with coupons and minimum spends.",o="flat"):(a="local")&&(e="Local pickup",t="Allow customers to pick up orders themselves. By default, when using local pickup store base taxes will apply regardless of customer address.",o="local"),$.ajax({url:baseUrl+"/admin/ecommerce/settings/shipping/method",type:"POST",data:{name:e,description:t,shipping_zone_id:l,type:o},headers:{"X-CSRF-TOKEN":$("#csrf-token").attr("content")},success:function(){location.reload()},error:function(e){new PNotify({title:"Error",text:401==e.status?e.responseText:"Error found while database operation.",type:"error",addclass:"notification-error",icon:"fas fa-times"})}})}),$(".switch input").change(function(e){var t=$(this).closest("tr").data("id");$.ajax({url:baseUrl+"/admin/ecommerce/settings/shipping/method/status",type:"POST",data:{id:t,enabled:$(this).prop("checked")?1:0},headers:{"X-CSRF-TOKEN":$("#csrf-token").attr("content")},success:function(){},error:function(e){new PNotify({title:"Error",text:401==e.status?e.responseText:"Error found while database operation.",type:"error",addclass:"notification-error",icon:"fas fa-times"})}})}),$(".delete-zone-button, .remove-row").click(function(){$(this).data("id")&&(o.push($(this).data("id")),$.magnificPopup.open({items:{src:"#delete-confirm-modal"},type:"inline"}))}),$(".remove-shipping-method").click(function(){var e=$(this).closest("tr").data("id");$.ajax({url:baseUrl+"/admin/ecommerce/settings/shipping/method/"+e,type:"DELETE",headers:{"X-CSRF-TOKEN":$("#csrf-token").attr("content")},success:function(){location.reload()},error:function(e){new PNotify({title:"Error",text:401==e.status?e.responseText:"Error found while database operation.",type:"error",addclass:"notification-error",icon:"fas fa-times"})}})}),$(document).on("change",".freeshipping-requirement",function(){"min_amount"==$(this).val()||"both"==$(this).val()||"either"==$(this).val()?$("#minOrderAmount").css("display","flex"):$("#minOrderAmount").css("display","none")}),$(".method-link").click(function(){t=$(this).closest("tr"),e=t.data("id"),$.magnificPopup.open({type:"ajax",tLoading:"",preloader:!1,removalDelay:350,items:{src:baseUrl+"/admin/ecommerce/settings/shipping/method/"+e},callbacks:{parseAjax:function(e){"free"==e.data.type?e.data='<div id="freeShippingModal" class="modal-block modal-block-lg">                                            <section class="card">                                                <header class="card-header">                                                    <h2 class="card-title">Free Shipping</h2>                                                </header>                                                <div class="card-body">                                                    <div class="modal-wrapper">                                                        <div class="form-group row align-items-center">                                                            <label class="col-lg-5 col-xl-3 control-label text-lg-right mb-0">Title</label>                                                            <div class="col-lg-7 col-xl-6">                                                                <input type="text" class="form-control form-control-modern method-name" value="'+e.data.name+'">                                                            </div>                                                        </div>                                                        <div class="form-group row align-items-center">                                                            <label class="col-lg-5 col-xl-3 control-label text-lg-right mb-0">Free shipping requires...</label>                                                            <div class="col-lg-7 col-xl-6">                                                                <select class="form-control form-control-modern freeshipping-requirement">                                                                    <option value="">NA</option>                                                                    <option value="coupon" '+("coupon"==e.data.free_shipping_requirement?"selected":"")+'>A valid free shipping coupon </option>                                                                    <option value="min_amount" '+("min_amount"==e.data.free_shipping_requirement?"selected":"")+'>A minimum order amount</option>                                                                    <option value="either" '+("either"==e.data.free_shipping_requirement?"selected":"")+'>A minimum order amount OR a coupon</option>                                                                    <option value="both" '+("both"==e.data.free_shipping_requirement?"selected":"")+'>A minimum order amount AND a coupon</option>                                                                </select>                                                            </div>                                                        </div>                                                        <div class="form-group row align-items-center" id="minOrderAmount">                                                            <label class="col-lg-5 col-xl-3 control-label text-lg-right mb-0">Minimum order amount</label>                                                            <div class="col-lg-7 col-xl-6">                                                                <input type="number" class="form-control form-control-modern order-amount" value="'+e.data.minimum_order_amount+'">                                                            </div>                                                        </div>                                                    </div>                                                </div>                                                <footer class="card-footer">                                                    <div class="row">                                                        <div class="col-md-12 text-right">                                                            <button class="btn btn-primary method-save-confirm">Confirm</button>                                                            <button class="btn btn-default modal-dismiss">Cancel</button>                                                        </div>                                                    </div>                                                </footer>                                            </section>                                        </div>':"local"==e.data.type?e.data='<div id="localPickupModal" class="modal-block modal-block-lg">                                                <section class="card">                                                    <header class="card-header">                                                        <h2 class="card-title">Local pickup</h2>                                                    </header>                                                    <div class="card-body">                                                        <div class="modal-wrapper">                                                            <div class="form-group row align-items-center">                                                                <label class="col-lg-5 col-xl-3 control-label text-lg-right mb-0">Title</label>                                                                <div class="col-lg-7 col-xl-6">                                                                    <input type="text" class="form-control form-control-modern method-name" value="'+e.data.name+'">                                                                </div>                                                            </div>                                                            <div class="form-group row align-items-center">                                                                <label class="col-lg-5 col-xl-3 control-label text-lg-right mb-0">Tax status</label>                                                                <div class="col-lg-7 col-xl-6">                                                                    <select class="form-control form-control-modern tax-status">                                                                        <option value="taxable" '+("taxable"==e.data.tax_status?"selected":"")+'>Taxable</option>                                                                        <option value="none" '+("none"==e.data.tax_status?"selected":"")+'>None</option>                                                                    </select>                                                                </div>                                                            </div>                                                            <div class="form-group row align-items-center">                                                                <label class="col-lg-5 col-xl-3 control-label text-lg-right mb-0">Cost</label>                                                                <div class="col-lg-7 col-xl-6">                                                                    <input type="number" class="form-control form-control-modern cost" value="'+e.data.cost+'">                                                                </div>                                                            </div>                                                        </div>                                                    </div>                                                    <footer class="card-footer">                                                        <div class="row">                                                            <div class="col-md-12 text-right">                                                                <button class="btn btn-primary method-save-confirm">Confirm</button>                                                                <button class="btn btn-default modal-dismiss">Cancel</button>                                                            </div>                                                        </div>                                                    </footer>                                                </section>                                            </div>':e.data='<div id="flatRateModal" class="modal-block modal-block-lg">                                                <section class="card">                                                    <header class="card-header">                                                        <h2 class="card-title">Flat rate</h2>                                                    </header>                                                    <div class="card-body">                                                        <div class="modal-wrapper">                                                            <div class="form-group row align-items-center">                                                                <label class="col-lg-5 col-xl-3 control-label text-lg-right mb-0">Title</label>                                                                <div class="col-lg-7 col-xl-6">                                                                    <input type="text" class="form-control form-control-modern method-name" value="'+e.data.name+'">                                                                </div>                                                            </div>                                                            <div class="form-group row align-items-center">                                                                <label class="col-lg-5 col-xl-3 control-label text-lg-right mb-0">Tax status</label>                                                                <div class="col-lg-7 col-xl-6">                                                                    <select class="form-control form-control-modern tax-status">                                                                        <option value="taxable" '+("taxable"==e.data.tax_status?"selected":"")+'>Taxable</option>                                                                        <option value="none" '+("none"==e.data.tax_status?"selected":"")+'>None</option>                                                                    </select>                                                                </div>                                                            </div>                                                            <div class="form-group row align-items-center">                                                                <label class="col-lg-5 col-xl-3 control-label text-lg-right mb-0">Cost</label>                                                                <div class="col-lg-7 col-xl-6">                                                                    <input type="number" class="form-control form-control-modern cost" value="'+e.data.cost+'">                                                                </div>                                                            </div>                                                        </div>                                                    </div>                                                    <footer class="card-footer">                                                        <div class="row">                                                            <div class="col-md-12 text-right">                                                                <button class="btn btn-primary method-save-confirm">Confirm</button>                                                                <button class="btn btn-default modal-dismiss">Cancel</button>                                                            </div>                                                        </div>                                                    </footer>                                                </section>                                            </div>'},ajaxContentAdded:function(){$(".freeshipping-requirement").trigger("change")}},ajax:{tError:""}})}),$(".modal-confirm").click(function(){$.ajax({url:baseUrl+"/admin/ecommerce/settings/shipping/bulk",type:"DELETE",data:{data:o},headers:{"X-CSRF-TOKEN":$("#csrf-token").attr("content")},success:function(){location.href=baseUrl+"/admin/ecommerce/settings/shipping"},error:function(e){new PNotify({title:"Error",text:401==e.status?e.responseText:"Error found while database operation.",type:"error",addclass:"notification-error",icon:"fas fa-times"})}})}),$("body").on("click",".method-save-confirm",function(){var o=$(this).closest(".card");$.ajax({url:baseUrl+"/admin/ecommerce/settings/shipping/method/"+e,type:"PUT",data:{name:o.find(".method-name").val(),tax_status:o.find(".tax-status").val(),cost:o.find(".cost").val(),minimum_order_amount:o.find(".order-amount").val(),free_shipping_requirement:o.find(".freeshipping-requirement").val()},headers:{"X-CSRF-TOKEN":$("#csrf-token").attr("content")},success:function(e){t.find(".method-link").text(e.name),$.magnificPopup.close()},error:function(e){new PNotify({title:"Error",text:401==e.status?e.responseText:"Error found while database operation.",type:"error",addclass:"notification-error",icon:"fas fa-times"})}})}),$("body").on("click",".modal-dismiss",function(){$.magnificPopup.close()}),$(".bulk-action-apply").click(function(e){e.preventDefault();var t=$(".table tbody :checked");o=[];for(var a=0;a<t.length;a++)o.push(t.eq(a).data("id"));0==o.length||"delete"!=$(".bulk-action").val()?new PNotify({title:"Warning",text:"It will not work.",type:"error",addclass:"notification-warning",icon:"fas fa-exclamation"}):$.magnificPopup.open({items:{src:"#delete-confirm-modal"},type:"inline"})})});